<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Historial de Servicios</title>
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <style>
    body { background-color: #f4f6f9; }
    .card { border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); margin-bottom: 30px; }
    .card-header { background: linear-gradient(90deg, #1e90ff, #6a11cb); color: white; font-weight: bold; text-align: center;
      border-top-left-radius: 15px; border-top-right-radius: 15px; font-size: 20px; padding: 15px; }
    th, td { text-align: center; vertical-align: middle; }
    .btn { border-radius: 20px; padding: 6px 18px; }
  </style>
</head>
<body>
<div class="container mt-5">

  <!-- Historial del cliente -->
  <div class="card">
    <div class="card-header">
      Historial de Servicios del Cliente
    </div>
    <div class="card-body">
      <div th:if="${success != null}" class="alert alert-success" th:text="${success}"></div>
      <div th:if="${error != null}" class="alert alert-danger" th:text="${error}"></div>

      <table class="table table-striped table-bordered">
        <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Descripci√≥n</th>
          <th>Precio</th>
          <th>Estado</th>
          <th>Proveedor</th>
          <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="servicio : ${historial}" th:if="${servicio.cliente != null}">
          <td th:text="${servicio.idServicio}"></td>
          <td th:text="${servicio.nombre}"></td>
          <td th:text="${servicio.descripcion}"></td>
          <td th:text="${servicio.precio}"></td>
          <td th:text="${servicio.estado}"></td>
          <td th:text="${servicio.proveedor != null ? servicio.proveedor.nombreUsuario : 'Sin asignar'}"></td>
          <td>
            <form th:action="@{|/Clientes/${servicio.cliente.idUsuario}/cancelarServicio/${servicio.idServicio}|}" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <button type="submit" class="btn btn-danger btn-sm">Cancelar</button>
            </form>
          </td>
        </tr>
        </tbody>
      </table>

      <div class="text-center mt-4">
        <a th:href="@{/Clientes/{idCliente}/solicitarServicio(idCliente=${idCliente})}" class="btn btn-secondary">Solicitar Nuevo Servicio</a>
      </div>
    </div>
  </div>
</div>
</body>
</html>

