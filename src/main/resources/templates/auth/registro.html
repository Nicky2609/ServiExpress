<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>Crear cuenta</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <style>
    :root { --bg:#f6ece3; --card:#fff; --stroke:#ead8ce; --text:#2b2b2b; --muted:#9a7d72; --brand:#c77462; }
    *{box-sizing:border-box}
    body{min-height:100vh;margin:0;display:grid;place-items:center;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:var(--text)}
    .card{width:min(560px,94vw);background:var(--card);border:1px solid var(--stroke);border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.06)}
    .body{padding:28px}
    h1{margin:0 0 10px}
    .group{margin:14px 0}
    label{font-weight:600;display:block;margin:0 0 6px}
    input{width:100%;padding:12px 14px;border:1px solid #dec6bb;border-radius:12px;font-size:1rem}
    .row{display:flex;gap:12px;margin-top:14px}
    .row.two > *{flex:1}
    .btn{border-radius:12px;padding:12px 16px;font-weight:700;border:1px solid var(--brand);cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:transparent;color:var(--brand)}
    .error{color:#8b1a1a;font-size:.9rem;margin-top:6px}
    .alert{padding:12px 14px;border-radius:12px;margin:10px 0;background:#fde8e8;border:1px solid #f4b4b4;color:#8b1a1a}
    .pw-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:.9rem;color:var(--muted)}
    .pw-wrap{position:relative}
  </style>
</head>
<body>
<div class="card">
  <div class="body">
    <h1>Crear cuenta</h1>
    <p style="color:var(--muted);margin-top:0">Regístrate para empezar a usar ServiExpress.</p>

    <!-- Resumen de errores globales -->
    <div class="alert" th:if="${#fields.hasGlobalErrors()}"
         th:each="e : ${#fields.globalErrors()}" th:text="${e}">Hay errores en el formulario.</div>

    <form th:action="@{/auth/registro}" th:object="${form}" method="post" novalidate>
      <div class="group">
        <label for="nombreUsuario">Nombre</label>
        <input id="nombreUsuario" th:field="*{nombreUsuario}" placeholder="Tu nombre"
               maxlength="80" autocomplete="name" required>
        <div class="error" th:if="${#fields.hasErrors('nombreUsuario')}" th:errors="*{nombreUsuario}"></div>
      </div>

      <div class="group">
        <label for="correo">Correo</label>
        <input id="correo" type="email" th:field="*{correo}" placeholder="tucorreo@dominio.com"
               maxlength="120" autocomplete="email" required>
        <div class="error" th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}"></div>
      </div>

      <div class="row two">
        <div class="group">
          <label for="telefono">Teléfono</label>
          <input id="telefono" th:field="*{telefono}" placeholder="300 123 4567"
                 inputmode="tel" autocomplete="tel" required>
          <div class="error" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
        </div>

        <div class="group">
          <label for="ciudad">Ciudad</label>
          <input id="ciudad" th:field="*{ciudad}" placeholder="Tu ciudad"
                 maxlength="100" autocomplete="address-level2" required>
          <div class="error" th:if="${#fields.hasErrors('ciudad')}" th:errors="*{ciudad}"></div>
        </div>
      </div>

      <div class="group">
        <label for="password">Contraseña</label>
        <div class="pw-wrap">
          <input id="password" type="password" th:field="*{password}" minlength="6" maxlength="120"
                 autocomplete="new-password" required>
          <span class="pw-toggle" data-target="password">mostrar</span>
        </div>
        <div class="error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
      </div>

      <div class="group">
        <label for="confirmarPassword">Confirmar contraseña</label>
        <div class="pw-wrap">
          <input id="confirmarPassword" type="password" th:field="*{confirmarPassword}" minlength="6" maxlength="120"
                 autocomplete="new-password" required>
          <span class="pw-toggle" data-target="confirmarPassword">mostrar</span>
        </div>
        <div class="error" th:if="${#fields.hasErrors('confirmarPassword')}" th:errors="*{confirmarPassword}"></div>
      </div>

      <!-- CSRF -->
      <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

      <div class="row">
        <a class="btn ghost" th:href="@{/auth/login}">Ya tengo cuenta</a>
        <button class="btn primary" type="submit">Crear cuenta</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.querySelectorAll('.pw-toggle').forEach(t => {
    t.addEventListener('click', () => {
      const id = t.getAttribute('data-target');
      const input = document.getElementById(id);
      const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
      input.setAttribute('type', type);
      t.textContent = type === 'password' ? 'mostrar' : 'ocultar';
    });
  });
</script>
</body>
</html>