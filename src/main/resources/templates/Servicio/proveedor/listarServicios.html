<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Mis Servicios</title>

    <!-- Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root{
            --bg1:#fdeee6; --bg2:#f8e3d8; --page:#f7f4f1;
            --text:#3e2a2a; --muted:#7b5e57;
            --brand:#c77462; --brand-600:#ba6b59; --brand-2:#a45445;
            --ring:#e9c9be; --line:#efdfd7; --surface:#fff;
            --ok:#1f9d65; --ok-bg:#e9f8ef; --warn:#8b5e00; --warn-bg:#fff7e8; --off:#7a6f68; --off-bg:#f1eeec;
            --radius:14px;
        }
        *{box-sizing:border-box}
        body{
            margin:0; background:var(--page); color:var(--text);
            font-family:Poppins,system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
        }
        a{color:inherit;text-decoration:none}

        .container{max-width:1100px;margin:0 auto;padding:18px}

        /* NAVBAR */
        .navbar{
            position:sticky; top:0; z-index:60;
            background:linear-gradient(90deg,var(--bg1),var(--bg2));
            border-bottom:1px solid var(--line);
            backdrop-filter:saturate(1.15) blur(6px);
        }
        .navbar .inner{
            max-width:1200px;margin:0 auto;padding:10px 16px;
            display:flex;align-items:center;gap:14px;
        }
        .brand a{font-weight:800;font-size:20px;color:var(--brand-2)}
        .nav-spacer{flex:1}
        .nav-actions{display:flex;align-items:center;gap:10px}

        .btn{
            display:inline-flex;align-items:center;justify-content:center;gap:8px;
            padding:9px 16px;border-radius:12px;font-weight:700;font-size:14px;cursor:pointer;
            border:1px solid var(--brand); color:var(--brand-2); background:#fff0; transition:.18s ease;
        }
        .btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(199,116,98,.18)}
        .btn.solid{background:var(--brand);color:#fff;border-color:var(--brand)}
        .btn.solid:hover{background:var(--brand-600)}
        .btn.ghost{background:#fff0;border-color:var(--brand)}
        .btn.secondary{border-color:#d9c7c0;color:#6a4b44;background:#fff}
        .btn.secondary:hover{background:#fff7f4;border-color:#f0d5ce}
        .btn.danger{background:#d35445;color:#fff;border-color:#d35445}
        .btn.danger:hover{background:#b24438}
        .btn.linklike{border-color:transparent;padding:9px 10px;color:#8d5b50}

        /* HEADER */
        h1{margin:6px 0 4px;font-size:clamp(22px,3vw,28px)}
        .subtle{color:var(--muted);font-weight:600}

        /* CARD WRAP */
        .table-wrap{
            margin-top:14px;background:var(--surface);border:1px solid var(--line);
            border-radius:var(--radius);box-shadow:0 20px 40px rgba(0,0,0,.06);overflow:hidden;
        }

        /* SEARCH FIELD */
        .search-field{
            width:100%;max-width:420px;margin:10px 0;
            display:flex;align-items:center;gap:8px;
            background:#fff;border:1px solid var(--ring);border-radius:999px;padding:10px 14px;
            box-shadow:0 8px 20px rgba(199,116,98,.08);
        }
        .search-field input{border:0;outline:0;width:100%;font:inherit;color:var(--text);background:transparent}

        /* TABLE */
        .table-scroll{overflow-x:auto}
        table{width:100%;border-collapse:collapse;min-width:860px}
        thead th{
            background:var(--bg2); color:var(--brand-2);
            padding:12px 14px;text-align:left;font-weight:800;white-space:nowrap
        }
        tbody td{padding:12px 14px;border-top:1px solid var(--line)}
        tbody tr:hover{background:#fff8f4}
        .actions{display:flex;gap:8px;flex-wrap:wrap}

        /* Estado pill */
        .pill{
            display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-weight:800;
            border:1px solid var(--line);background:#faf7f5;color:var(--muted)
        }
        .pill[data-state="DISPONIBLE"]{background:var(--ok-bg);color:var(--ok);border-color:#cfeedd}
        .pill[data-state="OCUPADO"], .pill[data-state="NO_DISPONIBLE"]{background:var(--warn-bg);color:var(--warn);border-color:#ffe0b3}
        .pill[data-state="INACTIVO"]{background:var(--off-bg);color:var(--off)}

        /* Modal */
        .modal-overlay{
            position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.45);
        }
        .modal-overlay.open{display:grid}
        .modal{
            width:min(420px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px;
            box-shadow:0 24px 50px rgba(0,0,0,.18);transform:translateY(6px);animation:pop .16s ease-out forwards;
        }
        @keyframes pop{to{transform:translateY(0)}}
        .modal h2{margin:0 0 10px;font-size:20px}
        .modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:14px}
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="inner">
        <div class="brand"><a th:href="@{/}">ServiExpress</a></div>
        <div class="nav-spacer"></div>
        <div class="nav-actions">
            <a class="btn ghost" th:href="@{/}">Inicio</a>
            <a class="btn solid" th:href="@{/solicitud/proveedor/listar}">ðŸ“œ Ver Historial</a>
            <form th:action="@{/auth/logout}" method="post" style="margin:0">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button type="submit" class="btn linklike">Cerrar sesiÃ³n</button>
            </form>
        </div>
    </div>
</nav>

<!-- CONTENIDO -->
<div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
        <div>
            <h1>Mis Servicios</h1>
            <div class="subtle">Gestiona y edita tus servicios publicados.</div>
        </div>
        <a class="btn solid" th:href="@{/servicio/crearServicio}">+ Crear servicio</a>
    </div>

    <!-- Buscador -->
    <label class="search-field" for="buscar">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#b07a6e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        <input id="buscar" type="search" placeholder="Buscar por nombre, descripciÃ³n o estadoâ€¦">
    </label>

    <div class="table-wrap">
        <div class="table-scroll">
            <table>
                <thead>
                <tr>
                    <th>Nombre</th>
                    <th>DescripciÃ³n</th>
                    <th>Precio</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody id="tablaServicios">
                <tr th:each="servicio : ${servicios}">
                    <td th:text="${servicio.nombre}">â€”</td>
                    <td th:text="${servicio.descripcion}">â€”</td>
                    <td th:text="${servicio.precio}">0</td>
                    <td>
            <span class="pill"
                  th:attr="data-state=${servicio.estado}"
                  th:text="${servicio.estado}">DISPONIBLE</span>
                    </td>
                    <td>
                        <div class="actions">
                            <a th:href="@{/servicio/editar/{id}(id=${servicio.idServicio})}" class="btn secondary">Editar</a>
                            <button type="button" class="btn danger"
                                    th:attr="data-id=${servicio.idServicio}"
                                    onclick="abrirModal(this)">Eliminar</button>
                        </div>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(servicios)}">
                    <td colspan="5" style="text-align:center;padding:18px">No tienes servicios registrados</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal eliminar -->
<div id="modalEliminar" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <h2 id="modalTitle">Â¿Eliminar este servicio?</h2>
        <p class="subtle">Esta acciÃ³n no se puede deshacer.</p>
        <form id="formEliminar" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <div class="modal-actions">
                <button type="button" class="btn secondary" onclick="cerrarModal()">Cancelar</button>
                <button type="submit" class="btn danger">Eliminar</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Modal
    const modal = document.getElementById("modalEliminar");
    const formEliminar = document.getElementById("formEliminar");
    function abrirModal(btn){
        const idServicio = btn.getAttribute("data-id");
        formEliminar.setAttribute("action", "/servicio/eliminar/" + idServicio);
        modal.classList.add("open"); modal.setAttribute("aria-hidden","false");
    }
    function cerrarModal(){
        modal.classList.remove("open"); modal.setAttribute("aria-hidden","true");
    }
    modal.addEventListener("click", e => { if(e.target === modal) cerrarModal(); });
    document.addEventListener("keydown", e => { if(e.key === "Escape") cerrarModal(); });

    // Filtro
    const inputBuscar = document.getElementById("buscar");
    inputBuscar.addEventListener("input", function(){
        const filtro = (this.value||"").toLowerCase();
        const filas = document.querySelectorAll("#tablaServicios tr");
        filas.forEach(fila=>{
            if (fila.querySelector('td[colspan]')) return;
            const texto = fila.textContent.toLowerCase();
            fila.style.display = texto.includes(filtro) ? "" : "none";
        });
    });
</script>

</body>
</html>